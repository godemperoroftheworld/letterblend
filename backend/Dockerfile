FROM node:18-alpine AS deploy-stage
# Build-time arguments
ARG PORT
ARG MOVIE_API
ARG SCRAPE_SERVICE_URL
ARG ROOM_SERVICE_URL
# Set Env Variables
ENV NODE_ENV production
ENV PORT ${PORT}
ENV MOVIE_API ${MOVIE_API}
ENV SCRAPE_SERVICE_URL ${SCRAPE_SERVICE_URL}
ENV ROOM_SERVICE_URL ${ROOM_SERVICE_URL}
ENV JET_LOGGER_MODE CONSOLE
ENV JET_LOGGER_FILEPATH jet-logger.log
ENV JET_LOGGER_TIMESTAMP TRUE
ENV JET_LOGGER_FORMAT LINE
# Install
COPY . .
RUN npm install -g yarn
RUN yarn install
RUN yarn build
# Run
EXPOSE $PORT
CMD ["yarn","start"]